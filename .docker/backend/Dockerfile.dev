# Development stage for backend
FROM node:20-alpine
ENV NODE_ENV=development

WORKDIR /backend-app

RUN corepack enable

# Copy workspace configuration
COPY package.json pnpm-lock.yaml pnpm-workspace.yaml turbo.json ./

# Copy all package.json files
COPY apps/backend/package.json apps/backend/
COPY packages/drizzle/package.json packages/drizzle/
COPY packages/eslint-config/package.json packages/eslint-config/
COPY packages/typescript-config/package.json packages/typescript-config/

# Install dependencies
RUN pnpm install --frozen-lockfile
RUN turbo build

# Copy source code
COPY . .

EXPOSE 4000
CMD ["pnpm", "--filter", "backend", "dev"]
